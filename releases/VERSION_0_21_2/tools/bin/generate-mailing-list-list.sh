#!/bin/sh

# Generate web pages that can be used for monitoring and editing mailing lists
#
# The reason for the need for this script is that it is somewhat cumbersome
# to click through the Tigris site to examine that all mailing lists are
# set correctly.

EDIT=edit.html
VIEW=view.html
SUBSCRIBERS=subs.html

files="$EDIT $VIEW $SUBSCRIBERS"
projects="argouml \
    argouml-gen argouml-mdr argoumlinstaller \
    argouml-downloads argouml-stats \
    argouml-ada argouml-classfile argouml-cpp argouml-csharp argouml-delphi \
    argouml-idl argouml-php argouml-python \
    argouml-ca argouml-de argouml-en-gb argouml-es argouml-fr \
    argouml-i18n-zh argouml-nb argouml-pt argouml-ru argouml-sv argouml-zh-cn \
    argoprint argouml-andromda argouml-emf argouml-sql"
lists="dev cvs issues users commits announce"

for f in $files
do
    echo "<!-- This file was generated by the script $Id$ -->" > $f
    echo '<HTML>' >> $f
    echo '<HEAD><TITLE>Mailing list administration for the ArgoUML projects</TITLE></HEAD>' >> $f
    echo '<BODY>' >> $f
    echo '<a name="top"></a>' >> $f
done

# First we generate the index
for f in $files
do
    for proj in $projects
    do
        echo "$proj: " >> $f
        for listname in $lists
	do
            echo "<a href=\"#$proj-$listname\">$listname</a>" >> $f
        done
        echo "<br>" >> $f
    done

    echo "<hr>" >> $f
done


for proj in $projects
do
    for listname in $lists
    do
        for f in $files
	do
	    echo '<DIV class="h2"><h2>' >> $f
            echo "<a name=\"$proj-$listname\">$listname in the project $proj</a>" >> $f
	    echo '</h2>' >> $f
            echo "<a href=\"#top\">Top</a> " >> $f
        done

	echo "<a href=\"http://$proj.tigris.org/nonav/servlets/MailingListEdit?list=$listname\" target=\"frame-$proj-$listname\">Refetch</a>" >> $EDIT
	echo "<a href=\"http://$proj.tigris.org/servlets/MailingListEdit?list=$listname\" target=\"_blank\">Open</a>" >> $EDIT
        echo "<br>" >> $EDIT
        echo "<IFRAME name=\"frame-$proj-$listname\" SRC=\"http://$proj.tigris.org/nonav/servlets/MailingListEdit?list=$listname\" width=\"800\" height=\"600\"></IFRAME>" >> $EDIT

	echo "<a href=\"http://$proj.tigris.org/nonav/servlets/SummarizeList?list=$listname\" target=\"frame-$proj-$listname\">Refetch</a>" >> $VIEW
	echo "<a href=\"http://$proj.tigris.org/nonav/servlets/SummarizeList?list=$listname\" target=\"_blank\">Open</a>" >> $VIEW
        echo "<br>" >> $VIEW
        echo "<IFRAME name=\"frame-$proj-$listname\" SRC=\"http://$proj.tigris.org/nonav/servlets/SummarizeList?list=$listname\" width=\"800\" height=\"600\"></IFRAME>" >> $VIEW

	for subscribersalt in Subscribers Subscribers+Digest Moderators Allowed+Posters
	do
	    echo '<DIV class="h3"><h3>' >> $SUBSCRIBERS
            echo "$subscribersalt for $listname in the project $proj" >> $SUBSCRIBERS
	    echo '</h3>' >> $SUBSCRIBERS

	    echo "<a href=\"http://$proj.tigris.org/nonav/servlets/MailingListMembers?list=$listname&group=$subscribersalt\" target=\"frame-$proj-$listname-$subscribersalt\">Refetch</a>" >> $SUBSCRIBERS
	    echo "<a href=\"http://$proj.tigris.org/nonav/servlets/MailingListMembers?list=$listname&group=$subscribersalt\" target=\"_blank\">Open</a>" >> $SUBSCRIBERS
	    echo "<br>" >> $SUBSCRIBERS
            echo "<IFRAME name=\"frame-$proj-$listname-$subscribersalt\" SRC=\"http://$proj.tigris.org/nonav/servlets/MailingListMembers?list=$listname&group=$subscribersalt\" width=\"650\" height=\"450\"></IFRAME>" >> $SUBSCRIBERS
	    echo '</DIV>' >> $SUBSCRIBERS
        done

        for f in $files
	do
	    echo '</DIV>' >> $f
        done
    done
done

for f in $files
do
    echo '</BODY></HTML>' >> $f
done
