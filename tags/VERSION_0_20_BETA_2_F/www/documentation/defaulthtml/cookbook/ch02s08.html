<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>2.8.&nbsp;Making a release</title><link rel="stylesheet" href="look-and-feel.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.66.1"><link rel="start" href="index.html" title="Cookbook for Developers of ArgoUML"><link rel="up" href="ch02.html" title="Chapter&nbsp;2.&nbsp;Building from source"><link rel="prev" href="ch02s07.html" title="2.7.&nbsp;Generating documentation"><link rel="next" href="ch03.html" title="Chapter&nbsp;3.&nbsp;ArgoUML requirements"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">2.8.&nbsp;Making a release</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch02s07.html">Prev</a>&nbsp;</td><th width="60%" align="center">Chapter&nbsp;2.&nbsp;Building from source</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="ch03.html">Next</a></td></tr></table><hr></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="release_process"></a>2.8.&nbsp;Making a release</h2></div></div></div><a class="indexterm" name="d0e2365"></a><p>
The purpose of this chapter is
to simplify for the person that is actually doing the release work and
to make sure that everything is done in the exact same way 
every time and nothing is forgotten.
</p><p>
The scripts involved have been developed and are mostly run
on a Cygwin system.
They will hopefully work on any UNIX system but most likely they
will need some adjustments.
</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td colspan="2" align="left" valign="top"><p>
This is under rework now that the distribution is to be done using
a SVN project.
</p></td></tr></table></div><p>
The artifacts in play here are
<tt class="filename">argouml/src_new/build.xml</tt>,
<tt class="filename">argouml/tools/bin/build-release.sh</tt>,
<tt class="filename">argouml/tools/bin/pack-release.sh</tt>, and
other <tt class="filename">build.xml</tt> files.
The plan for the future is that the <tt class="filename">build.xml</tt>
files contain rules on how to compile and package things into jar files.
After that the
<tt class="filename">argouml/tools/bin/build-release.sh</tt> and
<tt class="filename">argouml/tools/bin/pack-release.sh</tt>
will be taken care of
signing,
packing into tar, zipped archives, packing sources, and
uploading.

The <tt class="filename">build.xml</tt> will have rules that places the
complete runnable release in
<tt class="filename">argouml/build</tt>.
These are the same rules used by developers when compiling for testing.
The
<tt class="filename">build-release.sh</tt> and
<tt class="filename">pack-release.sh</tt>
script takes it from there.
</p><p>
Prerequisites (what you need to be able to do this):
</p><div class="itemizedlist"><ul type="disc"><li><p>
CVS access to the argouml project (to set tags).
</p><p>
You also need CVS access to the included sub-projects to set the tags there:
(argouml-mdr, argouml-csharp, argouml-nb, ... and this list will probably grow).
</p></li><li><p>
SVN access to the argouml-downloads project (to upload the result).
</p></li><li><p>
A machine.
</p><p>
This is probably the machine you use for your development if you are
an argouml developer.
</p><p>
The machine needs
Internet access (it is not a small download and upload so at least
128KB Internet connection to keep the time reasonable &lt; 2 hours),
the correct version of Java installed (should be a JDK 1.4.2),
CVS and SVN installed,
Unix or Cygwin to be able to run the scripts.
</p></li><li><p>
That you have set the CVSROOT correctly.
</p><p>
Make sure it is set to 
<span><b class="command">:pserver:<i class="replaceable"><tt>user</tt></i>@cvs.tigris.org:/cvs</b></span>.
</p></li></ul></div><p>
</p><p>
Here are the steps to be done when one actually does a release:
</p><p>
      </p><div class="orderedlist"><ol type="1"><li><p>Set the <tt class="methodname">argo.core.version</tt>
to not include the "PRE-" part.
</p><p>
This is done in the <tt class="filename">default.properties</tt>-file
in <tt class="filename">src_new</tt>
and <tt class="filename">documentation</tt>
and then, commit the files.
</p></li><li><p>Tag the CVS repository with the freeze tag!</p><p>
Normally this tag is "VERSION_<i class="replaceable"><tt>X_Y_Z</tt></i>_F",
e.g. VERSION_0_9_7_F.
The according command line CVS command is 
<span><b class="command">cvs rtag VERSION_<i class="replaceable"><tt>X_Y_Z</tt></i>_F argouml</b></span>.
</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td colspan="2" align="left" valign="top"><p>

Because of a problem on the Tigris site, this doesn't work. 
The workaround is that you
make sure you have a complete checked out and copy of ArgoUML,
go to the root directory 
<tt class="filename">argouml</tt>,
and run the command
<span><b class="command">cvs tag VERSION_<i class="replaceable"><tt>X_Y_Z</tt></i>_F</b></span>.
</p></td></tr></table></div><p>
</p><p>
You also need to set the tag in the sub-projects so the following command
is more like it:
</p><pre class="programlisting">
for proj in argouml argouml-mdr argouml-csharp argouml-nb argouml-i18n-zh
do
    ( cd $proj &amp;&amp; cvs tag VERSION_<i class="replaceable"><tt>X_Y_Z</tt></i>_F )
done
</pre><p>
</p></li><li><p>
Open the repository for commits toward the next version.
</p><p>
This is done by setting the <tt class="methodname">argo.core.version</tt>
in <tt class="filename">default.properties</tt>
in <tt class="filename">src_new</tt>
and <tt class="filename">documentation</tt>
to PRE-<i class="replaceable"><tt>Number of next release</tt></i>, committing
and telling everyone on the developers mailing list.
</p></li><li><p>
Check the key to sign the jar files for Java Web Start.
</p><p>
Run the command
<span><b class="command">keytool -list -v</b></span>
and give the keystore password 
<i class="parameter"><tt>secret</tt></i>.
You should have a key named argouml that is valid several months
in the future.
</p><p>
This is to make sure that you have a valid key
for the purpose of signing the Java Web Start version of the files.
</p><div class="sidebar"><p>
Since the ArgoUML project and the Tigris organization are loose
organizations we cannot buy a "real" key.
The keys we use are the unsigned keys
that can be generated by anyone using the keytool provided with Java.
</p></div><p>
A key is generated with the command
<span><b class="command">keytool -genkey -alias argouml -storepass secret</b></span>.
</p><p>
By default these keys have a validity of just three (3) months
but by giving the
<i class="parameter"><tt>-validity <i class="replaceable"><tt>days</tt></i></tt></i>
the validity can be extended.
</p></li><li><p>
Run the script
<tt class="filename">argouml/tools/bin/build-release.sh</tt>
and give the answers to the questions.
</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td colspan="2" align="left" valign="top"><p>
You need to have this file checked out.
</p><p>
Actually the script assumes the following set up:
</p><div class="itemizedlist"><ul type="disc"><li><p>
<tt class="filename">somedirectory/</tt> -
the directory where the script is started from.
</p></li><li><p>
<tt class="filename">somedirectory/argouml</tt> -
the place where a checked out copy of ArgoUML resides and the documentation
can be built.
</p><p>
The script is located here and the 
<tt class="filename">JimiProClasses.zip</tt>
is taken from this installation so if you can build the PDF documentation
correctly in this, a lot is gained.
</p></li><li><p>
<tt class="filename">somedirectory/<i class="replaceable"><tt>FREEZETAG</tt></i></tt> -
the created that will be created where the whole build will take place
</p></li><li><p>
<tt class="filename">svn/argouml-downloads/trunk/www/</tt> -
where the files to be uploaded will go
</p><p>
Notice that this is starts one step up, on the same level as
<tt class="filename">somedirectory</tt>.
It will be accessed using a path like
<tt class="filename">../svn/argouml-downloads/trunk/www</tt>.
</p><p>
This is achieved using the following commands:
</p><pre class="programlisting">
cd ..
svn co -N http://argouml-downloads.tigris.org/svn/argouml-downloads/trunk/www argouml-downloads/trunk/www
</pre><p>
</p></li></ul></div><p>
</p></td></tr></table></div><p>
This will:
</p><div class="orderedlist"><ol type="a"><li><p>
Check out the source in a new directory.
The new directory is named after the freeze tag that you have set.
</p></li><li><p>
Make the <span><b class="command">ant</b></span> executable.
</p></li><li><p>
Build the core ArgoUML.
</p><p>
This is done in the
<tt class="filename">argouml/src_new</tt>
directory of the newly created copy
by using the <span><b class="command">package</b></span> ant target!
</p></li><li><p>
Build the sub-projects and modules to be included in the release.
</p></li><li><p>
Download docboox-xsl.
</p><p>
This is normally done using the <span><b class="command">docbook-xsl-get</b></span> ant target.
</p></li><li><p>
Copy the file <tt class="filename">JimiProClasses.zip</tt>.
</p><p>
This is done automatically from the working copy you have alongside.
If not, you will be asked to copy this in manually.
</p><p>
Jimi is downloaded separately.
See 
<a href="ch02s02.html#download-jimi">Jimi</a>.
</p></li><li><p>
Build the PDF documentation.
</p></li><li><p>
Run through the automatic tests!
</p><p>
This is done by issuing the command
<span><b class="command">build alltests</b></span>
in the <tt class="filename">argouml/src_new</tt> directory.
</p><p>
There should not be any failed tests. 
(See details on where to find the result in
<a href="ch02s05.html" title="2.5.&nbsp;The JUnit test cases">Section&nbsp;2.5, &#8220;The JUnit test cases&#8221;</a>).
</p><p>
If the tests did not pass See <a href="ch02s08.html#release_process_test_failed" title="2.8.1.&nbsp;The release did not work">Section&nbsp;2.8.1, &#8220;The release did not work&#8221;</a>.
</p></li><li><p>
Sign all jar files.
</p></li></ol></div></li><li><p>Test the release manually!</p><p>
The purpose of this is to make sure that there isn't any problem
introduced by the release procedure and that the jar files contains
the correct list of jars.
</p><p>
Start using the command
</p><pre class="programlisting">
cd VERSION_<i class="replaceable"><tt>X_Y_Z</tt></i>_F/argouml/build
java -jar argouml.jar
cd ../../..
</pre><p>
and do some ad-hoc testing.
</p></li><li><p>
Set the release tag.
</p><p>
The following command will do it for you:
</p><pre class="programlisting">
cd VERSION_<i class="replaceable"><tt>X_Y_Z</tt></i>_F
for proj in *
do
    ( cd $proj &amp;&amp; cvs tag VERSION_<i class="replaceable"><tt>X_Y_Z</tt></i> )
done
cd ..
</pre><p>
</p></li><li><p>
Run the script
<tt class="filename">argouml/tools/bin/pack-release.sh</tt>
</p><p>
This will:
</p><div class="orderedlist"><ol type="a"><li><p>
Create the files
<tt class="filename">ArgoUML-<i class="replaceable"><tt>VERSION</tt></i>-libs.tar.gz</tt>,
<tt class="filename">ArgoUML-<i class="replaceable"><tt>VERSION</tt></i>-libs.zip</tt>,
<tt class="filename">ArgoUML-<i class="replaceable"><tt>VERSION</tt></i>-modules.tar.gz</tt>,
<tt class="filename">ArgoUML-<i class="replaceable"><tt>VERSION</tt></i>-modules.zip</tt>,
<tt class="filename">ArgoUML-<i class="replaceable"><tt>VERSION</tt></i>-src.tar.gz</tt>,
<tt class="filename">ArgoUML-<i class="replaceable"><tt>VERSION</tt></i>-src.zip</tt>,
<tt class="filename">ArgoUML-<i class="replaceable"><tt>VERSION</tt></i>-app.tgz</tt>,
<tt class="filename">ArgoUML-<i class="replaceable"><tt>VERSION</tt></i>.tar.gz</tt>,
<tt class="filename">ArgoUML-<i class="replaceable"><tt>VERSION</tt></i>.zip</tt>, and
<tt class="filename">index.html</tt>.
There should also be a subdirectory
<tt class="filename">argouml/argouml-<i class="replaceable"><tt>VERSION</tt></i>/jws</tt>
with .jar and .jnlp files.
</p></li><li><p>
Copy the files in place in the svn directory.
</p><p>
A tree with all files is located in 
<tt class="filename">argouml-<i class="replaceable"><tt>version</tt></i></tt>.
It is copied to
<tt class="filename">svn/argouml-downloads/trunk/www/</tt>.
</p></li></ol></div></li><li><p>
Commit the release in the SVN download project.
</p><p>
The commands you would do for this are
</p><pre class="programlisting">
cd ../svn/argouml-downloads/trunk/www
svn add argouml-<i class="replaceable"><tt>VERSION</tt></i>
svn commit -m'Upload the release <i class="replaceable"><tt>VERSION</tt></i>'
</pre><p>
</p></li><li><p><a name="issuezilla_release_maintenance"></a>
Go through Issuezilla and check things.
</p><p>
Things to check are:
</p><div class="orderedlist"><ol type="a"><li><p>
That there is a Version created in Issuezilla for the newly created release.
</p><p>
The purpose of this is to make it possible for everyone 
to report bugs on the new release.
</p></li><li><p>
Make sure that the upcoming releases have 
target milestones created for them.
This needs to be done for all components that has the same
release scheme.
Also see that the numbering is the same in all components and
that it is in the correct chronological order
except for the not yet done releases that come before the already completed.
</p></li><li><p>
Change the target milestones of all the not yet resolved issues 
for this release to ---.
</p></li><li><p>
Change the target milestones of
any fixed issue
in component argouml
with target milestone ---
to that of the current release.
</p><p>
This is probably some developer that has fixed an issue but forgotten to
set the target milestone correctly.
</p></li><li><p>
Move all issues reported on 'current' to this release
(for the component argouml).
</p><p>
These items were reported between the previous version and this version.
Since 'current' will be reused for the next release, they need to be
locked to the closest release to where they were found.
</p></li><li><p><a name="reopen_remind_and_later"></a>Reopen RESOLVED/REMIND</p><p>
This can also be a good time to change all 
RESOLVED/REMIND.
Search for them and Reopen them.
</p></li><li><p><a name="check_for_later"></a>Check RESOLVED/LATER</p><p>
It could also be good to check that all
RESOLVED/LATER has a valid target milestone (must be an upcoming milestone).
Search for them and Reopen the ones that haven't.
Also, if the milestone denotes or is going to be resolved in
the upcoming release, Reopen them with a comment that they are now
active.
</p></li></ol></div></li><li><p>Make announcements!</p><p>
Add the index file to the directory
<tt class="filename">argouml/www/download</tt>
so that it will show up at the URL
<a href="http://argouml.tigris.org/download/releaseXXX.html" target="_top">http://argouml.tigris.org/download/release<i class="replaceable"><tt>012345</tt></i>.html</a>.
</p><p>
Add new file to the File Sharing area under the correct release.
Since a release is made, the Status of the files is "Baselined".
Use the URL added in the previous paragraph as Link.
</p><p>
Write a News announcement in the argouml project.

The announcement shall include
a statement on what kind of release this is,
information on what major things that have changed
(for stable releases this is a list of what
has changed since the last stable release).

It could also include
the list of resolved issues,
a list of serious known problems with this release 
(stable releases shouldn't have any),
technical details on how the release was built, and
the plan for the following release.
</p><p>
Write a short note on 
the users list (for development releases), and
announce lists (for stable releases or major breakthroughs).
Include the link to the new item.
</p><p>
Freshmeat: currently Thierry Lach does the Freshmeat announcements
which require a login so just inform him.
</p></li></ol></div><p>
</p><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="release_process_test_failed"></a>2.8.1.&nbsp;The release did not work</h3></div></div></div><a class="indexterm" name="d0e2867"></a><p>
This shouldn't happen! This really shouldn't happen!
</p><p>
The reason that this has happened is that one of the developers 
has made a mistake.
You now must decide a way forward.
</p><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="release_work_fix_problem_yourself"></a>2.8.1.1.&nbsp;Fix the problem yourself.</h4></div></div></div><p>
If the problem is obvious to you and you can fix it quickly, do so.
This is done by doing the following:
</p><div class="itemizedlist"><ul type="disc"><li><p>Make the release tag into a branch</p><p>
<span><b class="command">cvs rtag -b -r VERSION_<i class="replaceable"><tt>X_Y_Z</tt></i>_F BRANCH_<i class="replaceable"><tt>X_Y_Z</tt></i></b></span>
</p></li><li><p>Update your checked out copy to be on that branch</p><p>
<span><b class="command">cvs update -r BRANCH_<i class="replaceable"><tt>X_Y_Z</tt></i></b></span>
</p></li><li><p>Fix the problem in your checked out copy</p></li><li><p>Commit the problem in the branch</p><p>
<span><b class="command">cvs commit -m'Fix of problem blabla'</b></span>
</p></li><li><p>Continue the build process</p><p>
This is done by restarting the <span><b class="command">build dist-release</b></span>-command
and from that point on working in the branch instead of at the tag.
</p></li><li><p>
Explain to the culprit what mistakes he has made and how to fix it.
</p><p>
It is now his responsibility to make sure that the problem will not
appear in the next version.
He can do this either by merging in your fix or by fixing the problem
in some other way.
</p><p>
At this point an in-detail description of how poor programming skills
the culprit has and how ugly his mother is, is probably in place but
please keep it constructive!
Remember, you might be mistaken when you guess who the responsible is.
</p></li></ul></div><p>
</p></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e2932"></a>2.8.1.2.&nbsp;
Delay the release waiting for someone to fix the problem.
</h4></div></div></div><p>
Create the branch as described in 
<a href="ch02s08.html#release_work_fix_problem_yourself" title="2.8.1.1.&nbsp;Fix the problem yourself.">Section&nbsp;2.8.1.1, &#8220;Fix the problem yourself.&#8221;</a>.
Then tell the culprit and everyone on the developer list
what the problem is and that it is to be fixed in the
release branch a.s.a.p.
</p><p>
Monitor the changes made to the branch to verify that
no one commits anything else but the solutions to the
problems.
</p><p>
When you get notified that it is completed, 
update your checked out copy and continue the release work.
</p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch02s07.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="ch02.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="ch03.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">2.7.&nbsp;Generating documentation&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;3.&nbsp;ArgoUML requirements</td></tr></table></div></body></html>