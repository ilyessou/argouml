<?xml version="1.0" encoding="ISO-8859-1"?>
<!-- $Id$ -->
<!--
// Copyright (c) 1996-2006 The Regents of the University of California. All
// Rights Reserved. Permission to use, copy, modify, and distribute this
// software and its documentation without fee, and without a written
// agreement is hereby granted, provided that the above copyright notice
// and this paragraph appear in all copies.  This software program and
// documentation are copyrighted by The Regents of the University of
// California. The software program and documentation are supplied "AS
// IS", without any accompanying services from The Regents. The Regents
// does not warrant that the operation of the program will be
// uninterrupted or error-free. The end-user understands that the program
// was developed for research purposes and is advised not to rely
// exclusively on the program for any reason.  IN NO EVENT SHALL THE
// UNIVERSITY OF CALIFORNIA BE LIABLE TO ANY PARTY FOR DIRECT, INDIRECT,
// SPECIAL, INCIDENTAL, OR CONSEQUENTIAL DAMAGES, INCLUDING LOST PROFITS,
// ARISING OUT OF THE USE OF THIS SOFTWARE AND ITS DOCUMENTATION, EVEN IF
// THE UNIVERSITY OF CALIFORNIA HAS BEEN ADVISED OF THE POSSIBILITY OF
// SUCH DAMAGE. THE UNIVERSITY OF CALIFORNIA SPECIFICALLY DISCLAIMS ANY
// WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
// MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE. THE SOFTWARE
// PROVIDED HEREUNDER IS ON AN "AS IS" BASIS, AND THE UNIVERSITY OF
// CALIFORNIA HAS NO OBLIGATIONS TO PROVIDE MAINTENANCE, SUPPORT,
// UPDATES, ENHANCEMENTS, OR MODIFICATIONS.
-->

<chapter id="standards">
  <title>Standards for coding in ArgoUML</title>
  <indexterm>
    <primary>Coding Standards</primary>
  </indexterm>
  <indexterm>
    <primary>Standards</primary>
    <secondary>Coding</secondary>
  </indexterm>
  <sect1>
    <title>Rules for writing Java code</title>

    <para>
The coding style for ArgoUML is the following
</para>
    <itemizedlist>
      <listitem>
        <para>
Each file starts with some header info: 
file, 
version info, 
copyright notice.
Like this:
<programlisting>
// &dollar;Id&dollar;
// Copyright (c) 2005 The Regents of the University of California. All
// Rights Reserved. Permission to use, copy, modify, and distribute this
// software and its documentation without fee, and without a written
// agreement is hereby granted, provided that the above copyright notice
// and this paragraph appear in all copies.  This software program and
// documentation are copyrighted by The Regents of the University of
// California. The software program and documentation are supplied "AS
// IS", without any accompanying services from The Regents. The Regents
// does not warrant that the operation of the program will be
// uninterrupted or error-free. The end-user understands that the program
// was developed for research purposes and is advised not to rely
// exclusively on the program for any reason.  IN NO EVENT SHALL THE
// UNIVERSITY OF CALIFORNIA BE LIABLE TO ANY PARTY FOR DIRECT, INDIRECT,
// SPECIAL, INCIDENTAL, OR CONSEQUENTIAL DAMAGES, INCLUDING LOST PROFITS,
// ARISING OUT OF THE USE OF THIS SOFTWARE AND ITS DOCUMENTATION, EVEN IF
// THE UNIVERSITY OF CALIFORNIA HAS BEEN ADVISED OF THE POSSIBILITY OF
// SUCH DAMAGE. THE UNIVERSITY OF CALIFORNIA SPECIFICALLY DISCLAIMS ANY
// WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
// MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE. THE SOFTWARE
// PROVIDED HEREUNDER IS ON AN "AS IS" BASIS, AND THE UNIVERSITY OF
// CALIFORNIA HAS NO OBLIGATIONS TO PROVIDE MAINTENANCE, SUPPORT,
// UPDATES, ENHANCEMENTS, OR MODIFICATIONS.

package <replaceable>whatever</replaceable>;
<replaceable>...</replaceable>
</programlisting>
</para>
        <para>
The file and version is maintained by CVS using keyword substitution.
The year in the copyright notice is maintained manually.
</para>
        <para>
This differs from the Sun Code Conventions that 
requires the initial comment to be a C-style comment.
</para>
        <para>
This is checked by Checkstyle.
</para>
      </listitem>
      <listitem>
        <para>
All instance variables are private.
</para>
        <para>
This is not required by the Sun Code Conventions but
an additional requirement for ArgoUML.
</para>
        <para>
This is checked by Checkstyle.
</para>
      </listitem>
      <listitem>
        <para>
Use Javadoc for each class, instance variable, and method. 
In general do not put comments in the body of a method. 
If you are doing something complex enough to need a comment, consider
breaking it out into its own private commented method.
</para>
        <para>
This is not required by the Sun Code Conventions but
an additional requirement for ArgoUML.
</para>
        <para>
This is partly checked by Checkstyle.
Checkstyle does currently only warn if a Javadoc comment is omitted for
a public, protected or default visibility variable or method.
</para>
      </listitem>
      <listitem>
        <para>
Indicate places of future modifications with 
<programlisting>
// TODO: reason
</programlisting>
        </para>
        <para>
This differs from the Sun Code Conventions that 
uses either XXX or FIXME depending on if it works or not.
</para>
      </listitem>
      <listitem>
        <para>
Four spaces should be used as the unit of indentation.
Tabs must be set exactly every 8 spaces (not 4) and represent 2 indents.
</para>
        <para>
This is exactly as it is stated in the Sun Code Conventions.
It is here just for the emphasis.
</para>
        <para>
This is checked by Checkstyle.
</para>
      </listitem>
      <listitem>
        <para>
If possible use lines shorter than 80 characters wide.
</para>
        <para>
This is exactly as it is stated in the Sun Code Conventions.
It is here just for the emphasis.
</para>
        <para>
This is checked by Checkstyle.
Checkstyle ignores three kinds of lines in this check because of the
historical use of long class names and package names.
These are lines that contain
"//&nbsp;&dollar;Id:<replaceable>whatever</replaceable>&dollar;",
import statements, and
Javadoc comments with @see-tags.
</para>
      </listitem>
      <listitem>
        <para>
Open brace on same line (at end).
Both for if/while/for and for class and functions definitions.
</para>
        <para>
This is exactly as it is stated in the Sun Code Conventions.
It is here just for the emphasis.
</para>
      </listitem>

      <listitem>
        <para>
Use deprecation when removing public and protected
classes, 
methods and
attributes.
</para>
        <para>
Whenever you have a public or protected method or attribute in a class or
a public class 
that you want to 
remove,
change the signature in an incompatible way, or 
make change visibility for
you shall always deprecate it first.
After the next stable release you (or someone else) can remove it.
</para>
        <para>
In the future, when the subsystems are well defined and it is clear
what public or protected 
methods, attributes or classes 
that are part of a certain subsystem's
exported interface 
we can allow an exception to this rule for 
methods, attributes and classes 
that are not.
(See <xref linkend="subsystems_relationships"></xref>.)
</para>
        <para>
Write deprecation statements like this:
<programlisting>
     * @deprecated by <replaceable>your name</replaceable> in <replaceable>the upcoming release</replaceable>. Use {@link <replaceable>whatever</replaceable>}
     *             <replaceable>a complete explanation on what to do instead</replaceable>
</programlisting>
</para>
        <para>
This is not checked by Checkstyle.
</para>
        <para>
Rationale:
This is part of the "Do Simple Things"-development approach that we
use in ArgoUML.
ArgoUML is a big project with lots of legacy code that we do not know
exactly how it works.
Deprecation shows the intent between decision to remove a method and
the point where it is actually removed 
and this without breaking anything of the old code.
There are also modules or plug ins that we might know nothing about that
could be loaded by some user to run within ArgoUML to add functionality.
It is for the modules and plug ins that we always save 
deprecated methods to the next stable release.
It makes it possible for the module developers to do work during the 
unstable releases and release at the same time as ArgoUML releases its
stable release.
</para>
      </listitem>

      <listitem>
        <para>
Don't use deprecated methods or classes.
</para>
        <para>
Rationale:
Deprecation is an indication that a class is to be removed.
We always want to build ArgoUML in a way that allows for future updates
of everything.
Using things that are on the way out already when doing the implementation
is for this reason not allowed.
</para>
        <para>
Rationale 2:
If you feel like you really want to use a method that is deprecated instead
of the replacement you should first convince the person responsible
for doing the deprecation that he has made a mistake and upgrade ArgoUML
to a version of that library without that method or class deprecated.
If it is within ArgoUML discuss it with the person who actually did 
the deprecation or in the development team.
</para>
        <para>
Comment:
There is an ongoing work (probably perpetually) to change
the calls to deprecated methods and classes that
has been deprecated after used in ArgoUML.
This is a normal part of improving ArgoUML.
If this work is too slow it makes it impossible to upgrade to new
versions of different sub-tools. 
This problem is seen by "the person responsible for sourcing of the sub-tool"
when actually trying to upgrade the sub-tool.
(See <xref linkend="issues_subproducts"></xref>.)
</para>
      </listitem>

      <listitem>
        <para>
Don't use very long package and class names.
</para>
        <para>
To make the code readable,
keep class names shorter than 25 chars, and
have at most four levels of packages.
</para>
        <para>
Historically in the ArgoUML design,
a deep package structure has been used.
There are several places in the code where the package structure is
mimicking the UML hierarchy of objects resulting in impossibly long
package names like
<classname>org.argouml.model.uml.behavioralelements.collaborations.<replaceable>class name</replaceable></classname>, and
<classname>org.argouml.uml.ui.behavior.common_behavior.<replaceable>class name</replaceable></classname>.
</para>
        <para>
While establishing the subsystems we use a two-level approach much
like the rest of the Java world.
For the subsystem API we always use:
<classname>org.argouml.<replaceable>subsystem package name</replaceable></classname>
i.e. the classes are in the subsystem's directory and all subsystems have
package names that is a single level below <classname>org.argouml</classname>.
If a subsystem is really complex or will be complex
w.r.t. the amount of classes (meaning more than 50 files with classes),
we create new packages with internal classes on a single level below
the subsystem package.
</para>
        <para>
This is the plan for the subsystems and new classes.
Don't move old classes just yet!
That would create more confusion that it would help.
</para>
      </listitem>

      <listitem>
        <para>
For everything else follow
<ulink url="http://java.sun.com/docs/codeconv/html/CodeConvTOC.doc.html">
Code Conventions for the Java Programming Language
</ulink>
(called Sun Code Conventions)!
</para>
      </listitem>

    </itemizedlist>

    <para>
Some of these rules are marked with a comment that they are 
checked by a Checkstyle.
Checkstyle is a tool available with the ArgoUML development environment
preconfigured for these rules.
The current configuration can be found in
<filename>argouml/tools/checkstyle/checkstyle_argouml.xml</filename>.
</para>
    <para>
To run Checkstyle run the command
<command>build checkstyle</command> from the
<filename class="directory">argouml/src_new</filename>
directory.
This requires you to have checked out the directories
<filename class="directory">argouml/tools</filename>,
<filename class="directory">argouml/tests</filename>, and
<filename class="directory">argouml/src_new</filename>.
</para>
    <para>
The last couple of Checkstyle result are also available in 
the Xenofarm result.
</para>
    <para>
Checkstyle will also check some of the rules from the
Sun Code Conventions that are not stated here.
Furthermore Checkstyle nags about when the order of modifiers does
not conform to the suggestions in the
Java Language Specification, Section 8.1.1, 8.3.1, 8.4.3.
</para>
  </sect1>

  <sect1>
    <title>Rules for the building process</title>
    <para>
For the <filename>build.xml</filename> files we use the following rules.
    </para>
    <itemizedlist>
      <listitem>
        <para>
Be careful when downloading stuff.
        </para>
        <para>
ArgoUML is supposed to be a self-contains development environment.
Some times it is better to have things downloaded from the ant script
instead of from the CVS repository.
In that case separate the download-targets from the target that does
building so that it is easy for everyone to know when their 
development machine is working against the Internet and when it is not.     
        </para>
      </listitem>

      <listitem>
        <para>
Public targets shall have description.
Non-public targets shall not have description 
(write xml comments or echos instead).
        </para>
      </listitem>

      <listitem>
        <para>
Use ant-built-ins for everything.
        </para>
        <para>
ArgoUML is supposed to be a self-contains development environment.
If you feel tempted to use other tools (perl, sed, nsgmls), don't!
They are probably not present in all environments where we want to
run a development environment.
        </para>
      </listitem>
    </itemizedlist>
  </sect1>

  <sect1>
    <sect1info>
      <author>
        <firstname>Linus</firstname>
        <surname>Tolke</surname>
      </author>
    </sect1info>
    <title>Checklist for using sub-products</title>

    <para>
In the ArgoUML project we use several sub-products to solve parts
of the problem for us.
These sub-products are an important part of the ArgoUML tool and
must be handled in a good way if ArgoUML is going to be successful.
</para>
    <para>
When this is written (March 2004) we have had problems with the
discontinuance of one of the sub-products (NSUML) and will continue to 
have it for well some time in the future, until we have managed to replace it.
The problem with NSUML could probably not have been foreseen or avoided
if this checklist would have been in place when NSUML was taken into
the project but some more apparent risks with sub-product candidates might be.
</para>
    <para>
Here is the list of things to check in the sub-product
and to discuss with yourself and maybe with the ArgoUML development team
before considering to use it in the ArgoUML project.
</para>
    <itemizedlist>
      <listitem>
        <para>
License
</para>
        <para>
We must be allowed to
develop against,
release with,
distribute, and
use
the sub-product indefinitely
without monetary or other compensation.
</para>
        <para>
Rationale: 
We have no money in the ArgoUML project,
we don't want to have money in the ArgoUML project.
We have no organization that can enter agreements and live up to them.
We don't want to require our users to enter agreements to use ArgoUML.
</para>
      </listitem>
      <listitem>
        <para>
Java version
</para>
        <para>
The sub-product must have a policy that matches the ArgoUML project policy
on Java version requirements.
</para>
        <para>
Rationale: 
The ambition for ArgoUML is to be a working tool for
as many people as possible.
Java is still under development and there are nice features available in
future releases.
In ArgoUML we have a plan for how to handle this. It is to always support
two major releases of Java (currently JDK 1.3 and 1.4).
We cannot have a sub-product that restricts us in this aspect.
</para>
      </listitem>
      <listitem>
        <para>
Distribution
</para>
        <para>
We require the sub-products to make it possible for us to take the distribution,
enter it in our CVS repository and write rules to automate
the use of the sub-product while developing, releasing and running ArgoUML.
This automated use must be able to run without relying on access to some
server and without user intervention.
</para>
        <para>
The API documentation of the sub-product (assumed to be Javadoc)
we can use from some web site belonging to that sub-product.
</para>
        <para>
Rationale: 
In the ArgoUML project we want to make it as easy as possible for our users
to install ArgoUML.
We also want to make it as easy as possible for our developers to get their
development environment working and for the release manager to prepare
the releases.
</para>
      </listitem>
      <listitem>
        <para>
Road map
</para>
        <para>
The project developing the sub-product must have a plan that fits
the ArgoUML plan for the future.
</para>
        <para>
Rationale: 
If a sub-product will soon go somewhere else
i.e. stop doing what we require or stop supporting what we require,
then we will soon have troubles with that sub-product.
</para>
      </listitem>
      <listitem>
        <para>
Working project
</para>
        <para>
The project that develops the sub-product should be a working project.
Check that there is some person responsible for it,
preferably with a team or organization backing him.
Check that there is a plan for upcoming releases.
Check that there is a way to report bugs and enhancement requests.
</para>
        <para>
Rationale:
We don't want to rely on a sub-product where there is no chance of ever
getting a bug that we encounter fixed.
We are also part of an ever-evolving world.
Soon we want the tool to do more for us.
We should then be able to wish that and eventually get an updated sub-product.
</para>
      </listitem>
    </itemizedlist>
  <para>
Notice that we should not and don't need to do this in a passive way.
We should explain to the sub-product team what we want and why.
Especially for sub-products that we have already in ArgoUML but also
for project that we consider taking in.
This is to increase the likelihood that they will have us in mind when
planning and evolving.
</para>
    <para>
Here are the steps to go through and the recommended order
once the decision is taken to use the sub-product in ArgoUML:
</para>
    <itemizedlist>
      <listitem>
        <para>
Documentation
</para>
        <para>
Describe in the Cookbook in the appropriate subsystem section
what part of the problem that the sub-product solves and
how it is used in ArgoUML.
</para>
      </listitem>
      <listitem>
        <para>
Javadoc
</para>
        <para>
Enter the package list file in a special directory under
<filename class="directory">argouml/lib/javadocs</filename>.
Update the list of links used when building the Javadocs.
One place in <filename>default.properties</filename>,
One or two places in <filename>build.xml</filename>
(targets javadocs and javadocs-api).
</para>
        <para>
Test by referencing some class from the sub-product,
building the Javadoc, and
check that the link is working.
</para>
      </listitem>
      <listitem>
        <para>
Repository
</para>
        <para>
Assuming that the sub-product is distributed in a set of jar files,
add the jar files to the <filename class="directory">lib</filename> directory
in a versioned way together with the license file.
Use filenames like:
<filename><replaceable>subproduct</replaceable>-<replaceable>version</replaceable>.jar</filename>, and
<filename><replaceable>subproduct</replaceable>.LICENSE.txt</filename>.
</para>
        <para>
A future plan is to have each subsystem in their own directory.
If the sub-product in question belongs to a subsystem that is moved to a
separate directory you should put it in
the <filename class="directory">lib</filename> directory for that subsystem.
For the time being, there is only one
<filename class="directory">lib</filename> directory.
</para>
      </listitem>
      <listitem>
        <para>
Building
</para>
        <para>
Assuming that the sub-product is distributed in a set of jar files,
add the jar files to the list of files that are to be included
when building ArgoUML.
One place in <filename>default.properties</filename>,
Four places in <filename>build.xml</filename>
(targets init (tree places),
prerequisites,
package (two places),
new target check.<replaceable>subproduct</replaceable>), and
One possibly place in <filename>AboutBox.java</filename> (Constructor).
Notice especially that <filename>build.xml</filename> shall not contain
any version information.
Notice also that the text in <filename>AboutBox.java</filename>
shall not contain anything that needs to be localized but just
the sub-product name, reference and possibly version.
</para>
        <para>
Check by having some class from the sub-product loaded immediately
when starting ArgoUML and start using
<command>build run</command>.
</para>
      </listitem>
      <listitem>
        <para>
Running from modules
</para>
        <para>
With the current modules set up
(in <filename class="directory">argouml/modules</filename>) the
idea is that we are supposed to be able to start ArgoUML from any
of the modules directory.
This means that whenever changing the list of modules you will have
to update the classpaths in all these modules.
Go through the list of files <filename>argouml/modules/*/build.xml</filename>
and update.
</para>
        <para>
Check by having some class from the sub-product loaded immediately
when starting ArgoUML and start in each of these directories.
</para>
      </listitem>
      <listitem>
        <para>
Distribution
</para>
        <para>
Assuming that the sub-product is distributed in a set of jar files,
add the jar files to the list of files that are to be included
when releasing ArgoUML.
One place in <filename>build.xml</filename> (target dist-javawebstart),
One place in <filename>manifest.template</filename> (Class-Path),
In each of the Java Web Start files (resources),
In the <filename>Info.plist</filename> (ClassPath).
</para>
        <para>
Check by having some class from the sub-product loaded immediately
when starting ArgoUML and start with
<command>java -jar argouml.jar</command>,
using each of the Java Web Start files, and
from the Appbund (on a Mac).
</para>
      </listitem>
    </itemizedlist>

    <para>
See <xref linkend="issues_subproducts"></xref> for a discussion on 
how to handle bugs found in sub-products and
updates of the version of a sub-product.
</para>
  </sect1>

  <sect1>
    <sect1info>
      <author>
        <firstname>Linus</firstname>
        <surname>Tolke</surname>
      </author>
    </sect1info>
    <title>Settings for Eclipse 2</title>
    <para>
These style guides correspond to the following settings in Eclipse 2:
</para>
    <itemizedlist>
      <listitem>
        <para>In Preferences => Java => Code Formatter => New Lines</para>
        <para>
None of the boxes 
"Insert a new line before opening brace",
"Insert new lines in control statements",
"Clear all blank lines",
"Insert new line between 'else if'",
or
"Insert a new line inside an empty block"
are checked.
</para>
      </listitem>
      <listitem>
        <para>
In Preferences => Java => Code Formatter => Line Splitting
</para>
        <para>
Maximum line length is 80.
</para>
      </listitem>
      <listitem>
        <para>In Preferences => Java => Code Formatter => Style</para>
        <para>
None of the boxes
"Compact assignment"
or
"Indentation is represented by a tab"
are checked.
</para>
        <para>
Number of spaces representing a tab: 4.
This should probably be read as Number of spaces representing a 
level of indentation.
</para>
      </listitem>
      <listitem>
        <para>In Preferences => Java => Java Editor => Appearance</para>
        <para>
Displayed tab width: 8
</para>
        <para>
"Insert space for tabs (see Formatting preferences)" checked.
There seems to be no way of having tabs set at width 8 and the
indentation level set at 4 at the same time so we must let
Eclipse generate code without tabs to obey the Sun Coding standard.
</para>
      </listitem>
    </itemizedlist>
  </sect1>
  <sect1>
    <sect1info>
      <author>
        <firstname>Linus</firstname>
        <surname>Tolke</surname>
      </author>
    </sect1info>
    <title>Settings for NetBeans</title>
    <para>
These style guides correspond to the following settings in NetBeans:
    </para>
    <itemizedlist>
      <listitem>
        <para>
In (Tools =>) Options => Editing => Editor Settings => Java Editor
        </para>
        <para>
Tab Size = 8
        </para>
      </listitem>
      <listitem>
        <para>
In (Tools =>) Options => Editing => 
Indentation Engines => Java Indentation Engine
        </para>
        <para>
Add Newline Before Brace: False,
Add Space Before Parenthesis: False,
Expand Tabs to Spaces: False,
Number of Spaces per Tab: 4 (Should probably be read as
Number of Spaces per indentation level).
        </para>
      </listitem>
    </itemizedlist>
  </sect1>
  <sect1>
    <sect1info>
      <author>
        <firstname>Linus</firstname>
        <surname>Tolke</surname>
      </author>
    </sect1info>
    <title>Settings for Emacs</title>
    <para>
These style guides correspond to the default Java settings in Emacs:
<programlisting>
 ("java"
  (c-basic-offset . 4)
  (c-comment-only-line-offset 0 . 0)
  (c-offsets-alist
   (inline-open . 0)
   (topmost-intro-cont . +)
   (statement-block-intro . +)
   (knr-argdecl-intro . 5)
   (substatement-open . +)
   (label . +)
   (statement-case-open . +)
   (statement-cont . +)
   (arglist-intro . c-lineup-arglist-intro-after-paren)
   (arglist-close . c-lineup-arglist)
   (access-label . 0)
   (inher-cont . c-lineup-java-inher)
   (func-decl-cont . c-lineup-java-throws)))
</programlisting>
    </para>
  </sect1>

  <sect1 id="eclipse3">
    <sect1info>
      <author>
	<firstname>Linus</firstname>
	<surname>Tolke</surname>
      </author>
    </sect1info>
    <title>How to work with Eclipse 3</title>
    <para>
If you are running Eclipse 3
you can find information on how to set
the development environment fitting ArgoUML.
There are several sets of instructions here depending that you can apply
separately depending on how much of the ArgoUML knowledge you would
want to include in your Eclipse.
</para>
    <para>
If any of these instructions don't work or could be improved in some way,
please help in making them better by contacting the editor of the Cookbook.
</para>
    <sect2 id="eclipse-checkout">
      <title>Checking out through Eclipse</title>
      <para>
This instruction is if you want to use Eclipse to download the source
and it takes you up to where you can start ArgoUML from the source.
</para>

      <orderedlist>
	<listitem>
	  <para>
Set up the CVS Repository.
</para>
	  <para>
Change to the CVS Repository perspective and select 
Add CVS Repository.
Then enter the following information.
</para>

	  <itemizedlist>
	    <listitem>
	      <para>Host:
cvs.tigris.org
</para>
	    </listitem>
	    <listitem>
	      <para>Repository path:
/cvs
</para>
	    </listitem>
	    <listitem>
	      <para>User:
<replaceable>Your Tigris user name.</replaceable>
</para>
	    </listitem>
	    <listitem>
	      <para>Password:
<replaceable>Your Tigris password.</replaceable>
</para>
	    </listitem>
	    <listitem>
	      <para>Connection type:
pserver
(default)
</para>
	    </listitem>
	    <listitem>
	      <para>Use Default Port. (default)</para>
	    </listitem>
	  </itemizedlist>
	</listitem>

	<listitem>
	  <para>
Check out.
</para>
	  <para>
In the CVS Repository Exploring perspective,
unfold the newly created repository 
(called something like
:pserver:<replaceable>your user name</replaceable>@cvs.tigris.org:/cvs)
and within it, HEAD.
</para>

	  <para>
Select the argouml-mdr project, right-click on it, and to Check Out As.
Check out as a project configured using the New Project Wizard.
Press the button Finish.
Select Java Project, and press Next.
Type the new project name: argouml-mdr, and press Next.
Ignore the build path settings. We will come back to them later.
Press Finish, which starts the checking out process.
You are probably directed to the Java Perspective with a question if
you want or not.
At this point, you better press No, to be able to perform the next step.
</para>

	  <para>
Select the argouml project, right-click on it, and do Check Out As.
Check out as a project configured using the New Project Wizard.
Press the button Finish.
Select Java Project, and press Next.
Type the new project name: argouml, and press Next.
Ignore the build path settings. We will come back to them later.
<!-- (Note MVW: I had to remove the item from the Source tab, 
otherwise the compile later on fails.) -->
Press Finish, which starts the checking out process.
You are probably directed to the Java Perspective with a question if
you want or not. At this point it doesn't matter. Just press Yes or No!
</para>
	  <para>
The download takes a while, since the download is around 60Meg.
</para>
	  <para>
Remark: 
If you are on a modem or other low bandwidth connection,
this is not recommended since you will download
all of the web site,
the source for the documentation, and
all modules,
things that you could do without unless you would want to work on them.
If you find a way to do this with less bandwidth use,
please help improving this description.
Theoretically we can come down to around 16Meg which would take around
two hours on a 56K modem.
</para>
	</listitem>

	<listitem>
	  <para>
Build using ant.
</para>
	  <para>
Browse to <filename>argouml/src_new/build.xml</filename>,
select the <filename>build.xml</filename>-file,
right-click on it, and do Run As - Ant Build...
This pops up the External Tools... pop up
with the Targets tab already selected.
Select compile (default target in the Targets tab),
deselect all other targets
and finally press Run.
</para>
	  <para>
Browse to <filename>argouml-mdr/build.xml</filename>,
select the <filename>build.xml</filename>-file,
right-click on it, and do Run As - Ant Build...
This pops up the External Tools... pop up
with the Targets tab already selected.
Select <command>generate</command>,
deselect all other targets
and finally press Run.
</para>
	    <para>
There are some files that are built using rules in the
<filename>build.xml</filename> files.
This is
the antlr-generated files,
the file containing a version, and
the java interfaces generated from the mof description.
</para>
	</listitem>

	<listitem>
	  <para>
Refresh the projects.
</para>
	  <para>
This must be done after having built using ant to find the newly created
Java files.
</para>
	  <para>
Select the top resource of the argouml project
in the Navigator (on the left),
right click and select <command>Refresh</command>.
</para>
	</listitem>

	<listitem>
	  <para>
Set build path for the argouml project.
</para>

	  <para>
      In the Java perspective, select the project argouml, 
      i.e. the icon at the top of the Package Explorer.
      Then, in the menu, select Project => Properties).
    </para>
	  <para>
Enter Java Build Path
</para>

	  <para>
Under Source:
Remove everything.
Add <filename class="directory">argouml/src_new</filename> and
<filename class="directory">argouml/src/model/src</filename>
(simply add a check mark in front of these folders).
Also add
<filename class="directory">argouml/tests</filename>,
<filename class="directory">argouml/modules/classfile/src</filename>,
and the src directories of all other modules.
The purpose of this is to have Eclipse recompile these and
find compilation errors
as soon as your changes to any API has affected them.
</para>
	  <para>
Under Libraries:
Press the Add JARs... button and add
all files in <filename class="directory">argouml/lib</filename>.
Press the Add JARs... button and add
the file <filename>argouml/tools/junit-3.7/junit.jar</filename>.
Every time any of these jars is updated in the project you will have to 
update this in your environment by entering this dialog,
removing the old ones, and
adding the new ones.
</para>
	  <para>
Under Order and Export:
Check that argouml/src/model/src is checked.
Check junit and log4j.
(If you also plan to work with the ArgoPrint subproject,
check gef and commons-logging.)
</para>
	  <para>
      Set the Default output folder to 
<filename class="directory">argouml/bin</filename>.
This will not confuse it with any of the ant-built things.
    </para>
	  <para>
Press OK.
You will be asked to accept that all resources previously built can
be removed. Press Yes.
Eclipse will rebuild.
    </para>
	  <para>
Verify that there are no errors in the argouml project,
just warnings left among the problems.
If there are errors in some of the modules you will be able to 
continue your work in spite of that but it is better if you stop here and
investigate the problem.
</para>
	  <para>
Some of the modules (cpp, idl, classfile, ???), contain ANTLR-generated code.
The rules to build these are in the ant files for each module.
Run the ant targets "generate" or "generateparser" in each of these
modules and then reload the source trees.
</para>
	</listitem>

	<listitem>
	  <para>
Set build path for the argouml-mdr project.
</para>

	  <para>
      In the Java perspective, select the project argouml-mdr, 
      i.e. the icon at the top of the Package Explorer.
      Then, in the menu, select Project => Properties).
    </para>
	  <para>
Enter Java Build Path
</para>

	  <para>
Under Source:
Remove everything.
Add <filename class="directory">argouml-mdr/src</filename> and
<filename class="directory">argouml-mdr/tests</filename>
(simply add a check mark in front of these folders).
</para>
	  <para>
Under Libraries:
Press the Add JARs... button and add
all files in <filename class="directory">argouml-mdr/lib</filename>.
Press the Add JARs... button and add
the file <filename>argouml-mdr/build/java-interfaces.jar</filename>.
</para>
	  <para>
Under Project:
Press the Add... button and add
the argouml project.
</para>
	  <para>
Under Order and Export:
Check 
<filename>java-interfaces.jar</filename>,
<filename>jmi.jar</filename>,
<filename>jmiutils.jar</filename>,
<filename>mdrapi.jar</filename>,
<filename>mof.jar</filename>,
<filename>nbmdr.jar</filename>, and
<filename>openide-util.jar</filename>,
(i.e. everything except the argouml project).
</para>
	  <para>
      Set the Default output folder to 
<filename class="directory">argouml-mdr/bin</filename>.
This will not confuse it with any of the ant-built things.
    </para>
	  <para>
Press OK.
You will be asked to accept that all resources previously built can
be removed. Press Yes.
Eclipse will rebuild.
    </para>
	  <para>
Verify that there are no errors
just warnings left among the problems.
</para>
	</listitem>


	<listitem>
	  <para>
Create a Run Configuration
</para>
	  <para>
      In the Java perspective, select the project argouml, 
      i.e. the icon at the top of the Package Explorer.
      Then, in the menu, select Run => Run...). 
      This will open the dialog for creating, managing 
      and running Run Configurations.
    </para>
	  <para>
      Select Java Application on the left and press the New button. 
      Name the configuration "Run ArgoUML".
In the Main tab press the Search... button in the Main class box.
      In the new dialog that appears (Choose Main Type), simply press OK.
    </para>
	  <para>
      This sets the Main class to: 
      <filename>org.argouml.application.Main</filename>.
    </para>
	  <para>
In the Classpath tab
select User Entries,
press Add Projects, and add the argouml-mdr project
with "Add exported entries of selected projects." checked and
"Add required projects of selected projects." not checked.
(The same needs to be done for all other configurations created
i.e. when running test cases from within Eclipse).
</para>
	  <para>
      Press the Run button.
      This will start ArgoUML. 
      From now on, you can start ArgoUML 
      by a single press on the Run icon in the toolbar.
    </para>
	</listitem>
	<listitem>
	  <para>
Verify that you can start ArgoUML from the debugger within Eclipse. 
You can do this by clicking on the Debug icon in the toolbar.
</para>
	</listitem>

      </orderedlist>
    </sect2>

    <sect2>
      <title>Eclipse to help with the ArgoUML coding style</title>
      <para>
This instruction is to set up Eclipse to work according to
the ArgoUML Coding standards.
If this is not done correctly you will most likely find that you will have to
do a lot of manual edits every time Eclipse has
touched the code.
You have your tool working against you instead of for you.
On the other hand, these settings affect your Eclipse Workspace rather than
the ArgoUML project settings so if you have other projects in
the same Eclipse Workspace there might be conflicts.
For this reason, it might be a good idea to do the ArgoUML work in an
Eclipse Workspace separate from your other projects.
</para>

      <itemizedlist>
	<listitem>
	  <para>
Code conventions.
</para>
	  <para>See in the menu Window => Preferences. 
      Then select Java => Code Style => Formatter.
Set the Code Formatter to "Java conventions [built-in]".
</para>
	</listitem>

	<listitem>
	  <para>
TAB character width is 8.
</para>
	  <para>
	  This will only work correctly by default from Eclipse V3.2 onwards.
</para>
	  <para>
Solution for Eclipse 3.0:
See in the menu Window => Preferences.
Then select
Java => Editor. Then select the tab Appearance.
Set the Displayed tab width to 8.
</para>
	  <para>
Solution for Eclipse 3.1:
In Eclipse 3.1 the Tab size is part of the profile that the 
Code Formatter uses.
Alas, the "Java conventions [built-in]"-profile contains a bug at this point
(<ulink url="https://bugs.eclipse.org/bugs/show_bug.cgi?id=104765"/>)
so the best solution is to create and use a new profile with the fix.
In Window => Preferences => Java => Code Style => Code Formatter,
set the Code Formatter to "Java conventions [built-in]" (as above),
press "Show",
select the "Indentation"-tab,
change "Tab size" to 8,
press "Apply", and
give the name 
<replaceable>Fixed Java conventions</replaceable>.
</para>
	</listitem>

	<listitem>
	  <para>
New file templates.
</para>

	  <para>
See in the menu Window => Preferences.
Then select
Java => Code Style => Code Templates.
At the right hand side, open the tree for Comments, and
set the Code Templates for Overriding methods to
<programlisting>
/**
 * &dollar;{see_to_overridden}
 */
</programlisting>
</para>

	  <para>
      In the same tree for Code Templates, 
      open the Code node and select New Java Files.
      Set it to
<programlisting>
// &dollar;&dollar;Id&dollar;&dollar;
// Copyright (c) 2006 The Regents of the University of California. All
// Rights Reserved. Permission to use, copy, modify, and distribute this
// software and its documentation without fee, and without a written
// agreement is hereby granted, provided that the above copyright notice
// and this paragraph appear in all copies.  This software program and
// documentation are copyrighted by The Regents of the University of
// California. The software program and documentation are supplied "AS
// IS", without any accompanying services from The Regents. The Regents
// does not warrant that the operation of the program will be
// uninterrupted or error-free. The end-user understands that the program
// was developed for research purposes and is advised not to rely
// exclusively on the program for any reason.  IN NO EVENT SHALL THE
// UNIVERSITY OF CALIFORNIA BE LIABLE TO ANY PARTY FOR DIRECT, INDIRECT,
// SPECIAL, INCIDENTAL, OR CONSEQUENTIAL DAMAGES, INCLUDING LOST PROFITS,
// ARISING OUT OF THE USE OF THIS SOFTWARE AND ITS DOCUMENTATION, EVEN IF
// THE UNIVERSITY OF CALIFORNIA HAS BEEN ADVISED OF THE POSSIBILITY OF
// SUCH DAMAGE. THE UNIVERSITY OF CALIFORNIA SPECIFICALLY DISCLAIMS ANY
// WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
// MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE. THE SOFTWARE
// PROVIDED HEREUNDER IS ON AN "AS IS" BASIS, AND THE UNIVERSITY OF
// CALIFORNIA HAS NO OBLIGATIONS TO PROVIDE MAINTENANCE, SUPPORT,
// UPDATES, ENHANCEMENTS, OR MODIFICATIONS.

&dollar;{package_declaration}

&dollar;{typecomment}
&dollar;{type_declaration}
</programlisting>
</para>
	</listitem>
      </itemizedlist>
    </sect2>

    <sect2>
      <title>Eclipse to automatically find problems in the code</title>
      <para>
This instruction is to set up Eclipse to automatically find 
what, in the ArgoUML project, could be considered problems in the code.
</para>
      <para>
You can apply these individually depending on what level of help you need
in your coding.
I (Linus Tolke) recommend that you set them all on the Warning level.
This makes them visible for you.
You can then decide to fix them or not depending on how you feel about
the code you are working with.
</para>
      <itemizedlist>
	<listitem>
	  <para>
Compiler compliance level.
</para>
	  <para>
      See in the menu Window => Preferences.
      Then select
      Java => Compiler.
      At the right hand side, select the tab
Compliance and classfiles => Compiler compliance level: 1.4.
</para>
	  <para>
In the ArgoUML project we have decided to keep source compliance to JDK 1.4.
(See <xref linkend="REQ7"/>).
This setting enables Eclipse to tell you where some
JDK 1.5
features have crept in.
</para>
	</listitem>

	<listitem>
	  <para>
Find forgotten and incorrect Javadoc comments.
</para>
	  <para>
In the menu select Window => Preferences.
Then select
Java => Compiler.
Suggested settings for these tabs
(Only things diverting from the Eclipse defaults are listed):
</para>
          <itemizedlist>
	    <listitem>
	      <para>
Javadoc => Malformed javadoc comments: Warning, Private, Report errors in tags.
</para>
	    </listitem>
	    <listitem>
	      <para>
Javadoc => Missing javadoc tags: Warning, Protected,
Check overriding and implementing methods.
</para>
	      <para>
These problems are also found by Checkstyle so if you are
running checkclipse (See <xref linkend="checkclipse"/>)
put this in Ignore instead.
</para>
	    </listitem>
	  </itemizedlist>
	</listitem>

	<listitem>
	  <para>
Code that hides other code.
</para>
	  <para>
In the menu select Window => Preferences.
Then select
Java => Compiler.
Suggested settings for these tabs
(Only things diverting from the Eclipse defaults are listed):
</para>
          <itemizedlist>
	    <listitem>
	      <para>
Style => Possible accidental boolean assignment: Warning.
</para>
	    </listitem>
	    <listitem>
	      <para>
Advanced => Local variable declaration hides another field or variable:
Warning.
</para>
	    </listitem>
	    <listitem>
	      <para>
Advanced => Field declaration hides another field or variable: Warning.
</para>
	    </listitem>
	  </itemizedlist>
	</listitem>
	<listitem>
	  <para>
Find Code that shall be removed.
</para>
	  <para>
In the menu select Window => Preferences.
Then select
Java => Compiler.
Suggested settings for these tabs
(Only things diverting from the Eclipse defaults are listed):
</para>
          <itemizedlist>
	    <listitem>
	      <para>
Unused code => Local variable is never read: Warning.
</para>
	    </listitem>
	    <listitem>
	      <para>
Unused code => Parameter is never read: Warning.
</para>
	    </listitem>
	    <listitem>
	      <para>
Unused code => Unused or unread private members: Warning.
</para>
</listitem>
	    <listitem>
	      <para>
Unused code => Unnecessary semicolon: Warning.
</para>
	    </listitem>
	    <listitem>
	      <para>
Unused code => Unnecessary cast or 'instanceof' operation: Warning.
</para>
	    </listitem>
	    <listitem>
	      <para>
Unused code => Unnecessary declaration of thrown checked exception: Warning.
</para>
	    </listitem>
	  </itemizedlist>
	</listitem>
      </itemizedlist>
    </sect2>

    <sect2 id="checkclipse">
      <title>Settings for checkclipse</title>
      <para>
      Checkclipse is a plug in for Eclipse which needs to be installed separately.
      It enables style checking according the rules set for the ArgoUML project.
    </para>
      <para>
      In the Java perspective, select the project argouml, 
      i.e. the icon at the top of the Package Explorer.
      Then, in the menu, select Project => Properties,
select Checkclipse (appears only if Checkclipse is correctly installed)
and then fill the fields like this:
</para>
      <itemizedlist>
	<listitem>
	  <para>Enable Checkstyle
Checked.
</para>
	</listitem>
	<listitem>
	  <para>Checkstyle Configuration File:
<filename>/argouml/tools/checkstyle/checkstyle_argouml.xml</filename>
</para>
	</listitem>
	<listitem>
	  <para>Checkstyle Properties File:
<filename>/argouml/tools/checkstyle/checkstyle.properties</filename>
</para>
	</listitem>
	<listitem>
	  <para>File Filter Definition:
<filename>/argouml/tools/checkstyle/checkclipse.filefilters</filename>
</para>
	</listitem>
      </itemizedlist>
      <para>
Leave the two other fields empty.
</para>
    </sect2>

    <sect2>
      <title>Run the JUnit tests</title>
      <para>
The problem is that to run ArgoUML, you need to have jars from both
the argouml project and
the argouml-mdr project
available in the class path.
If you don't, then all tests that actually do something with the
model subsystem will fail with a 
<classname>java.lang.ExceptionInInitializerError</classname>
(if it is the first test) or
<classname>java.lang.NoClassDefFoundError</classname>.
</para>

      <para>
The way the two projects are set up it is the argouml-mdr
project that depends on the argouml project.
This means that when running things from the argouml-mdr project
everything from the argouml project is available but not the other way around.
Since the tests are located in the argouml project,
the argouml-mdr things will be missing when running the tests as default.
</para>

      <para>
Here is the simplest way to run a test, fixing this:
</para>
      <orderedlist>
        <listitem>
          <para>
Start the test in the normal way i.e.
Right click on the test case and select 
Run As => JUnit Test,
Debug As => JUnit Test or
some keyboard short cut.
</para>
        </listitem>

        <listitem>
          <para>
Watch as the test fails with
<classname>java.lang.ExceptionInInitializerError</classname>
</para>
          <para>
If the test happens to succeed, 
either you have chosen one of the rare tests that actually don't use the model,
or you have not set up the two projects according to the instructions...
</para>
        </listitem>

        <listitem>
          <para>
From the Toolbar or from the Run menu select Debug... or Run...
A window will open with the Configuration to run the test.
</para>
        </listitem>

        <listitem>
          <para>
Change the project to the argouml-mdr project (in the Test tab).
</para>
        </listitem>

        <listitem>
          <para>
Press Debug (or Run).
</para>
        </listitem>

        <listitem>
          <para>
The test now works.
</para>
        </listitem>

      </orderedlist>
      <para>
Eclipse will remember the Configuration for that test so you can run it from
the Debug or Run Toolbars,
the Run => Run History or Run => Debug History menu items,
Right clicking on the same test and selecting Run... or Debug....
But if you do Right click on the same test followed by
Run As... or 
Debug As...
a new Configuration will be created that has the default project once again.
</para>
    </sect2>
  </sect1>

</chapter>



<!-- Local stuff for Emacs - please do not delete

Local Variables:
mode: xml
sgml-doctype: "cookbook.xml"
sgml-parent-document: ("cookbook.xml" "chapter" nil)
sgml-validate-command: "nsgmls -wxml -sv ../docbook-setup/xml.dcl \
  cookbook.xml"
End:

-->
