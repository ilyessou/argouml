<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;5.&nbsp;Inside the components</title><link rel="stylesheet" href="look-and-feel.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.60.1"><link rel="home" href="index.html" title="Cookbook for Developers of ArgoUML"><link rel="up" href="index.html" title="Cookbook for Developers of ArgoUML"><link rel="previous" href="ch04s07.html" title="4.7.&nbsp;Layer 3 - Description of components"><link rel="next" href="ch05s02.html" title="5.2.&nbsp;Critics and other cognitive tools"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter&nbsp;5.&nbsp;Inside the components</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch04s07.html">Prev</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="ch05s02.html">Next</a></td></tr></table><hr></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="inside_components"></a>Chapter&nbsp;5.&nbsp;Inside the components</h2></div></div><div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt>5.1. <a href="ch05.html#model">Model</a></dt><dd><dl><dt>5.1.1. <a href="ch05.html#d0e2590">Factories</a></dt><dt>5.1.2. <a href="ch05.html#d0e2625">Helpers</a></dt><dt>5.1.3. <a href="ch05.html#d0e2645">The model event pump</a></dt><dt>5.1.4. <a href="ch05.html#howdoi_model">How do I...?</a></dt></dl></dd><dt>5.2. <a href="ch05s02.html">Critics and other cognitive tools</a></dt><dd><dl><dt>5.2.1. <a href="ch05s02.html#d0e2866">Main classes</a></dt><dt>5.2.2. <a href="ch05s02.html#howdoi_critics">How do I ...?</a></dt><dt>5.2.3. <a href="ch05s02.html#d0e3144">org.argouml.cognitive.critics.* class diagram</a></dt></dl></dd><dt>5.3. <a href="ch05s03.html">Diagrams</a></dt><dd><dl><dt>5.3.1. <a href="ch05s03.html#howdoi_diagrams">How do I add a new element to a diagram?</a></dt><dt>5.3.2. <a href="ch05s03.html#d0e3192">How to add a new Fig</a></dt></dl></dd><dt>5.4. <a href="ch05s04.html">Property panels</a></dt><dd><dl><dt>5.4.1. <a href="ch05s04.html#addingapropertypanel">Adding the property panel</a></dt></dl></dd><dt>5.5. <a href="ch05s05.html">Reverse Engineering Component</a></dt><dt>5.6. <a href="ch05s06.html">Code Generation Component</a></dt><dt>5.7. <a href="ch05s07.html">Java - Code generations and Reverse Engineering</a></dt><dd><dl><dt>5.7.1. <a href="ch05s07.html#howdoi_reverse">How do I ...?</a></dt><dt>5.7.2. <a href="ch05s07.html#d0e5076">Which sources are involved?</a></dt><dt>5.7.3. <a href="ch05s07.html#d0e5083">How is the grammar of the target language implemented?</a></dt><dt>5.7.4. <a href="ch05s07.html#d0e5091">Which model/diagram elements are generated?</a></dt><dt>5.7.5. <a href="ch05s07.html#d0e5096">Which layout algorithm is used?</a></dt></dl></dd><dt>5.8. <a href="ch05s08.html">Other languages</a></dt><dt>5.9. <a href="ch05s09.html">The GUI Framework</a></dt><dd><dl><dt>5.9.1. <a href="ch05s09.html#d0e5233">Multi editor pane</a></dt><dt>5.9.2. <a href="ch05s09.html#d0e5268">Details pane</a></dt></dl></dd><dt>5.10. <a href="ch05s10.html">Help System</a></dt><dt>5.11. <a href="ch05s11.html">Internationalization</a></dt><dd><dl><dt>5.11.1. <a href="ch05s11.html#d0e5389">Organizing translators</a></dt><dt>5.11.2. <a href="ch05s11.html#d0e5432">Ambitions for localization</a></dt><dt>5.11.3. <a href="ch05s11.html#howdoi_internationalization">How do I ...?</a></dt></dl></dd><dt>5.12. <a href="ch05s12.html">Logging</a></dt><dd><dl><dt>5.12.1. <a href="ch05s12.html#d0e5665">What to Log in ArgoUML</a></dt><dt>5.12.2. <a href="ch05s12.html#d0e5693">How to Create Log Entries...</a></dt><dt>5.12.3. <a href="ch05s12.html#d0e5764">How to Enable Logging...</a></dt><dt>5.12.4. <a href="ch05s12.html#d0e5879">How to Customize Logging...</a></dt><dt>5.12.5. <a href="ch05s12.html#d0e5890">References</a></dt></dl></dd><dt>5.13. <a href="ch05s13.html">JRE with utils</a></dt><dt>5.14. <a href="ch05s14.html">To do items</a></dt><dt>5.15. <a href="ch05s15.html">Explorer</a></dt><dd><dl><dt>5.15.1. <a href="ch05s15.html#d0e5955">Details of current implementation</a></dt><dt>5.15.2. <a href="ch05s15.html#d0e5978">Requirements</a></dt><dt>5.15.3. <a href="ch05s15.html#d0e6012">Key Classes</a></dt><dt>5.15.4. <a href="ch05s15.html#d0e6065">How do I ...?</a></dt></dl></dd><dt>5.16. <a href="ch05s16.html">Module loader</a></dt><dd><dl><dt>5.16.1. <a href="ch05s16.html#d0e6137">What the ModuleLoader does</a></dt></dl></dd><dt>5.17. <a href="ch05s17.html">OCL</a></dt></dl></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Warning]" src="images/warning.png"></td><th align="left">Warning</th></tr><tr><td colspan="2" align="left" valign="top"><p>
This chapter is currently under rework with new component organization.
</p></td></tr></table></div><p>...</p><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="model"></a>5.1.&nbsp;Model</h2></div></div><div></div></div><p><a name="comp-model-purpose"></a>
Purpose - to provide the data structures that keep track of the model
and the diagrams. 
This comes with a complete set of methods to modify the model
and register interest in changes to the model.
</p><p>
The Model is located in <tt class="classname">org.argouml.model</tt>.
</p><p>
The Model is a Layer 1 component. See <a href="ch04s05.html" title="4.5.&nbsp;Layer 1 - Description of components">Section&nbsp;4.5, &#8220;Layer 1 - Description of components&#8221;</a>.
</p><p>
This is implemented using NSUML to implement the UML model.
</p><p>
ArgoUML uses several factories and helperclasses to manipulate the NSUML
model. 
The NSUML model itself does not define enough 'business' logic
to be directly used and the factories and helperclasses provide a
centralized place for accessing this 'business' logic.
Per section of chapter 2 of the UML 1.3 specification there is one factory
and one helper. They are placed in their own packages. The package name
convention is:
<tt class="classname">org.argouml.model.uml.SECTIONNAME</tt>
where sectionname is one of the following:
</p><div class="itemizedlist"><ul type="disc"><li><p>foundation</p></li><li><p>foundation.core</p></li><li><p>foundation.extensionmechanisms</p></li><li><p>foundation.datatypes</p></li><li><p>behavioralelements</p></li><li><p>behavioralelements.commonbehavior</p></li><li><p>behavioralelements.statemachines</p></li><li><p>behavioralelements.usecases</p></li><li><p>behavioralelements.collaborations</p></li><li><p>behavioralelements.activitygraphs</p></li><li><p>modelmanagement</p></li></ul></div><p>
</p><p>
Each package has at least a helper and a factory in it.
The factories contain all methods that deal with
creating and building modelelements.
The helpers contain all utility methods needed to manipulate
the modelelements.
</p><p>
Both helpers and factories are singletons.
The static method to access them is
<tt class="methodname">getFactory</tt> for the factory
and <tt class="methodname">getHelper</tt> for the helper.
</p><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e2590"></a>5.1.1.&nbsp;Factories</h3></div></div><div></div></div><p>
The factories contain at least for each modelelement a create method.
Example: <tt class="methodname">createClass</tt>
resides in <tt class="classname">CoreFactory</tt> in the package
<tt class="classname">org.argouml.model.uml.foundation.core</tt>.
Besides that, there are several buildmethods to build classes.
The build methods have a signature like
<code class="methodsynopsis"><span class="modifier">public&nbsp;</span><span class="type">MODELELEMENT&nbsp;</span><span class="methodname">buildMODELELEMENTNAME</span>(<span class="methodparam"><span class="parameter">params</span></span>);</code>.
</p><p>
Each build method verifies the wellformednessrules
as defined in the UML spec 1.3.
The reason for this is that NS-UML does not enforce
the wellformedness rules even though non-wellformed UML can lead to
non-wellformed XMI which leads to saving/loading issues and
all kinds of illegal states of argouml.
</p><p>
If you want to create an element you shall use the create methods
in the factories.
You are strongly advised to use a build method or, if there is
none that suits your needs, to build one thereby reusing the allready
existing build methods and utility methods in the helpers.
One reason for this is that the eventlisteners for
the newly created modelelement are setup correctly.
</p><p>
TODO: Am I allowed to call the factories from any thread?
</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e2625"></a>5.1.2.&nbsp;Helpers</h3></div></div><div></div></div><p>
The helpers contain all utility methods for manipulating modelelements.
For example, they contain methods to get all modelelements
of a certain class out of the model
(see <tt class="methodname">getAllModelelementsOfKind</tt> in 
<tt class="classname">ModelmanagementHelper</tt>).
</p><p>
To find a utility method you need to know where it is.
As a rule of thumb, a utility method for some modelelement 
is defined in the helper that corresponds with the section
in the UML specification.
For example, all utility methods for manipulating classes 
are defined in <tt class="classname">CoreHelper</tt>.
</p><p>
There are a few exceptions to this rule, mainly if 
the utility method deals with two modelelements 
that correspond to different sections in the UML
specification.
Then you have to look in both corresponding helpers and you
will probably find what you are searching for.
</p><p>
TODO: Am I allowed to call the helpers from any thread?
</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e2645"></a>5.1.3.&nbsp;The model event pump</h3></div></div><div></div></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e2648"></a>5.1.3.1.&nbsp;Introduction</h4></div></div><div></div></div><p>
Late 2002, the ArgoUML community decided for the introduction of a clean
interface between the NSUML model and the rest of ArgoUML.
This interface consists of three parts:
</p><div class="orderedlist"><ol type="1"><li><p>
The model factories, responsible for creation and deletion of modelelements
</p></li><li><p>
The model helpers, responsible for utility functions to manipulate the
modelelements and
</p></li><li><p>
The model event pump, responsible for sending model events to the rest
of ArgoUML.
</p></li></ol></div><p>
</p><p>
In other paragraphs the model factories and the model helpers are
already introduced.
Therefore we won't discuss them here again.
</p><p>
The model event pump is the gateway between the model elements and the
rest of ArgoUML.
Events fired by the modelelements are catched by the pump and then
'pumped' to those listeners interested in them.
The main advantage of this model is that the registration of listeners
is concentrated in one place (see picture *).
This makes it easier to change the interface between the model and the
rest of argouml.
</p><p>
Besides this, there are some improvements to the performance of the
pump made in comparision to the situation without the pump.
The main improvement is that you can register for just one type of
event and not for all events fired by some modelelement.
</p><p>
</p><div class="mediaobject"><img src="images/cookbook/eventsbeforepump.gif"></div><p>
</p><p>
</p><div class="mediaobject"><img src="images/cookbook/eventsafterpump.gif"></div><p>
</p><p>
The model event pump will replace all other event mechanisms for model
events in the future.
These mechanisms (like UMLChangeDispatch and ThirdPartyEventlisteners
for those who are interested) are DEPRECATED.
Do not use them therefore and do not use classes that use them.
</p></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e2684"></a>5.1.3.2.&nbsp;Public API</h4></div></div><div></div></div><p>
You might wonder: how does this all work?
Well, very simple in fact.
</p><p>
A modelevent (from now on a MEvent) has a name that uniquely
identifies the type of the event.

In most cases the name of the MEvent is equal to the name of the
property that was changed in the model.

In fact, there is even a 1-1 relationship between the type of MEvent
and the property changed in the model.

Therefore most listeners that need MEvents are only interested in one
type of MEvent since they are only interested in the status of 1
property.
</p><p>
TODO: What thread will I receive my event in? 
What locks will be held by the Model while I receive my event i.e.
is there something I cannot do from the event thread?
</p><p>
In the case described above (the most common one) you only have to
subscribe with the pump for that type of event.
This is explained in section <a href="ch05.html#pump-register-listener-for-type" title="5.1.3.2.1.&nbsp;&#xA;How do I register a listener for a certain type event&#xA;">Section&nbsp;5.1.3.2.1, &#8220;
How do I register a listener for a certain type event
&#8221;</a>
and <a href="ch05.html#pump-remove-listener-for-event" title="5.1.3.2.2.&nbsp;How do I remove a listener for a certain event">Section&nbsp;5.1.3.2.2, &#8220;How do I remove a listener for a certain event&#8221;</a>
</p><p>
Besides the case that you are interested in only one type of event (or
a set of types), there are occasions that you are interested in all
events fired by a certain modelelement or even for all events fired by
a certain type of modelelement.

For these cases, the pump has functionality too.

This is described in section 
<a href="ch05.html#pump-methods-for-adding-and-removing" title="5.1.3.2.3.&nbsp;&#xA;Hey, I saw some other methods for adding and removing?&#xA;">Section&nbsp;5.1.3.2.3, &#8220;
Hey, I saw some other methods for adding and removing?
&#8221;</a>.
</p><div class="sect4" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="pump-register-listener-for-type"></a>5.1.3.2.1.&nbsp;
How do I register a listener for a certain type event
</h5></div></div><div></div></div><p>
This is really very simple. Use the model
</p><pre class="programlisting">
addModelEventListener(MElementListener listener, MBase modelelement, String eventName)
</pre><p>
like this:
</p><pre class="programlisting">
UmlModelEventPump.getPump().addModelEventListener(this, modelelementIAmInterestedIn, "IamInterestedInThisEventnameType");
</pre><p>
Now your object this gets only the <tt class="classname">MEvents</tt>
fired by modelElementIAmInterestedIn that have the name
"IamInterestedInThisEventnameType".
</p></div><div class="sect4" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="pump-remove-listener-for-event"></a>5.1.3.2.2.&nbsp;How do I remove a listener for a certain event</h5></div></div><div></div></div><p>
This is the opposite of registering a listener. It all works with the
method
</p><pre class="programlisting">
removeModelEventListener(MElementListener listener, MBase modelElement, String eventName)
</pre><p>
on <tt class="classname">UmlModelEventPump</tt> like this:
</p><pre class="programlisting">
UmlModelEventPump.getPump().removeModelEventListener(this, modelelementIAmInterestedIn, "IamInterestedInThisEventnameType");
</pre><p>
Now your object is not registered any more for this event type. 
</p></div><div class="sect4" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="pump-methods-for-adding-and-removing"></a>5.1.3.2.3.&nbsp;
Hey, I saw some other methods for adding and removing?
</h5></div></div><div></div></div><p>
Yes there are some other method for adding and removing. 

You can add a listener that is interested in ALL events fired by a
certain modelelements.

This works with the method:
</p><pre class="programlisting">
addModelEventListener(MElementListener listener, MBase modelelement)
</pre><p>
As you can see no names of events you can register for here.
</p><p>
Furthermore, you can add a listener that is interested in several
types of events but coming from 1 modelelement.

This is a convenience method for not having to call the methods
explained in section
<a href="ch05.html#pump-register-listener-for-type" title="5.1.3.2.1.&nbsp;&#xA;How do I register a listener for a certain type event&#xA;">Section&nbsp;5.1.3.2.1, &#8220;
How do I register a listener for a certain type event
&#8221;</a>
more than once.

It works via:
</p><pre class="programlisting">
addModelEventListener(MElementListener listener, MBase modelelement, String[] eventNames)
</pre><p>
</p><p>
You can pass the method an array of strings with eventnames in which
your listener is interested.
</p><p>
Thirdly there is a very powerfull method to register your listener to
ALL events fired by a ALL modelelements of a certain class.

You can understand that using this method can have severe performance
impacts.
Therefore use it with care. 

The method is:
</p><pre class="programlisting">
addClassModelEventListener(MElementListener listener, Class modelClass)
</pre><p>
There are also methods that allow you to register only for one type of
event fired by all modelelements of a certain class and to register
for a set of types of events fired by all modelements of a certain
class.
</p><p>
Of course you can remove your listeners from the event pump. 
This works with methods starting with remove instead of add.
</p></div></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e2755"></a>5.1.3.3.&nbsp;Tips</h4></div></div><div></div></div><div class="orderedlist"><ol type="1"><li><p>
Don't forget to remove your listener from the eventpump if it's not
interested in some event any more.
</p><p>
If you do not remove it, that's gonna cost performance and it will
give you a hard time to debug all the logical bugs you see in your
listener.
</p></li><li><p>
When you implement your listener, it is wise to NOT DO the following:
</p><pre class="programlisting">
propertyChanged(MElementEvent event) {
      // do my thing for event type 1
      // do my thing for event type 2
      // etc.
}
</pre><p>
</p><p>
This will cause the things that need to be done for event type 1 to be
fired when event type 2 do arrive.
</p><p>
This still happens at a lot of places in the code of ArgoUML, most
notably in the modelChanged method of the children of
FigEdgeModelElement.
</p></li></ol></div></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e2774"></a>5.1.3.4.&nbsp;The future</h4></div></div><div></div></div><p>
Some people might wonder if we cannot make a better interface between
the model and the rest of ArgoUML if we use our own event types.

These people are right. 

There are plans to replace the MElementListener with
PropertyChangeListeners and using the PropertyChangeEvents instead of
the MElementEvent.

This has not been done yet since this involves a lot of work and
testing.
</p><p>
Next to this, it is likely that the implementation of the Event pump
itself is going to change.

Not the API but the implementation! At the moment the event pump does
not use the AWT Event Thread for dispatching events.

This can make argouml slow (in the perception of the user). 
</p><p>
Besides that, the current implementation does not use the standard
data structure that Swing uses for event registriation
(i.e. <tt class="classname">javax.swing.EventListenerList</tt>).

We are in the process of researching if it is a good thing to use this
standard instead of our own implementation.
</p></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="howdoi_model"></a>5.1.4.&nbsp;How do I...?</h3></div></div><div></div></div><div class="itemizedlist"><ul type="disc"><li><p>...add a new model element?</p><p>
Make a parameterless build method for your NSUML modelelement in one of
the UML Factories (for instance <tt class="classname">CoreFactory</tt>).
Stick to the UML 1.3 spec to choose the correct Factory.
The package structure under <tt class="classname">org.argouml.model.uml</tt>
follows the chapters in the UML spec so get it and read it!
In the buildmethod, create a new modelelement using the appropriate
create method in the factory.
The build method e.g. is a wrapper around the create method.
For all elements there are already create methods (thanks Thierry).
For some elements there are already build methods.
If you need one of these elements, use the build method before you
barge into building new ones.
Initialize all things you need in the build method as far as they
don't need other modelelements.
In the UML spec you can read which elements you need to initialize.
See for example <tt class="methodname">buildAttribute()</tt> for an example.
</p><p>
If you need to attach other already existing modelelements to your
modelelement make a 
<tt class="methodname">buildXXXX(MModelelement toattach1, ...)</tt> 
method in the factory where you made the build method. 
Don't ever call the create methods directly. 
If we use the build methods we will always have initialized
modelelements which will make a difference concerning save/load issues
for example.
</p><p>
Now you probably also need to create 
a Property Panel
and
a Fig object (See <a href="ch05s03.html#howto_createnewfig_2" title="5.3.2.5.&nbsp;Creating a new Fig (explanation 2)">Section&nbsp;5.3.2.5, &#8220;Creating a new Fig (explanation 2)&#8221;</a>).
</p></li><li><p>...create a new create method?</p><p>
Create it in the correct factory.
</p></li><li><p>...create a new utility method?</p><p>
Create it in the correct helper.
</p></li></ul></div></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch04s07.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="index.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="ch05s02.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">4.7.&nbsp;Layer 3 - Description of components&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;5.2.&nbsp;Critics and other cognitive tools</td></tr></table></div></body></html>