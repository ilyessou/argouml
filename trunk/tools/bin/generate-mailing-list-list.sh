#!/bin/sh

# Generate web pages that can be used for monitoring and editing mailing lists
#
# The reason for the need for this script is that it is somewhat cumbersome
# to click through the Tigris site to examine that all mailing lists are
# set correctly.

EDIT=edit.html
VIEW=view.html
SUBSCRIBERS=subs.html

files="$EDIT $VIEW $SUBSCRIBERS"
# First the projects directly under argouml
# Then the projects under seeds
# Last, all other projects
projects="argouml \
    argouml-andromda \
    argouml-classfile \
    argouml-cpp \
    argouml-csharp \
    argouml-de \
    argouml-downloads \
    argouml-en-gb \
    argouml-es \
    argouml-fr \
    argouml-gen \
    argouml-i18n-zh \
    argouml-idl \
    argouml-mdr \
    argouml-nb \
    argouml-php \
    argouml-pt \
    argouml-python \
    argouml-ru \
    argouml-ruby \
    argouml-stats \
    argoumlinstaller \
    seeds \
    argouml-ada \
    argouml-ca \
    argouml-delphi \
    argouml-emf \
    argouml-hi \
    argouml-it \
    argouml-ja \
    argouml-java \
    argouml-pattern-wizard \
    argouml-pt-br \
    argouml-ro \
    argouml-sql \
    argouml-sv \
    argouml-zh-cn \
    argouml-zh-tw \
    \
    argoprint \
    argouml-ar \
"


lists="dev cvs issues users commits announce"

for f in $files
do
    echo "<!-- This file was generated by the script $Id$ -->" > $f
    echo '<HTML>' >> $f
    echo '<HEAD><TITLE>Mailing list administration for the ArgoUML projects</TITLE></HEAD>' >> $f
    echo '<BODY>' >> $f
    echo '<a name="top"></a>' >> $f
done

# First we generate the index
for f in $files
do
    for proj in $projects
    do
        echo "$proj: " >> $f
        for listname in $lists
	do
            echo "<a href=\"#$proj-$listname\">$listname</a>" >> $f
        done
        echo "<br>" >> $f
    done

    echo "<hr>" >> $f
done

# The delay is increased once per list. For every lap we write several
# lists in different files so each file will bigger delays...
delay=10000
delayincr=1000

# Here is a function for one list.
# The arguments are:
# 1 - the servlet and arguments
# 2 - the project
# 3 - the listname
function onelist() {
    echo "<a href=\"http://$2.tigris.org/nonav/servlets/$1\" target=\"frame-$2-$3\">Refetch</a>"
    echo "<a href=\"http://$2.tigris.org/servlets/$1\" target=\"_blank\">Open</a>"
    echo "<br>"
    echo "<IFRAME name=\"frame-$2-$3\" width=\"800\" height=\"600\"></IFRAME>"
    echo "<script>"
    echo "setTimeout(\"document.frames('frame-$2-$3').location.href='http://$2.tigris.org/nonav/servlets/$1'\", $delay)"
    echo "</script>"
    echo "<br>"
    delay=`expr $delay + $delayincr`

}


for listname in $lists
do
    for proj in $projects
    do
        for f in $files
	do
	    echo '<DIV class="h2"><h2>' >> $f
            echo "<a name=\"$proj-$listname\">$listname in the project $proj</a>" >> $f
	    echo '</h2>' >> $f
            echo "<a href=\"#top\">Top</a> " >> $f
        done

	onelist MailingListEdit?list=$listname $proj $listname >> $EDIT
	onelist SummarizeList?list=$listname $proj $listname >> $VIEW

	for subscribersalt in Subscribers Digest+Subscribers Moderators Allowed+Posters
	do
	    echo '<DIV class="h3"><h3>' >> $SUBSCRIBERS
            echo "$subscribersalt for $listname in the project $proj" >> $SUBSCRIBERS
	    echo '</h3>' >> $SUBSCRIBERS

	    onelist "MailingListMembers?list=$listname&group=$subscribersalt" $proj $listname-$subscribersalt >> $SUBSCRIBERS

	    echo '</DIV>' >> $SUBSCRIBERS
        done

        for f in $files
	do
	    echo '</DIV>' >> $f
        done
    done
done

for f in $files
do
    echo '</BODY></HTML>' >> $f
done
